<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetHub - æœºç¾¤ç®¡ç†ä¸­å¿ƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; }
        :root { --primary: #4F46E5; --primary-light: #818CF8; --bg-dark: #0D1117; --bg-card: #161B22; --bg-card-hover: #1C2128; --border: #30363D; --text-primary: #E6EDF3; --text-secondary: #8B949E; --success: #3FB950; --warning: #D29922; --danger: #F85149; --offline: #6E7681; --running: #58A6FF; }
        body { background: var(--bg-dark); color: var(--text-primary); }
        .app { display: flex; min-height: 100vh; }
        .sidebar { width: 220px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 20px 0; position: fixed; height: 100vh; }
        .logo { padding: 0 20px 24px; display: flex; align-items: center; gap: 10px; }
        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .logo h1 { font-size: 18px; font-weight: 700; }
        .nav-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; padding: 16px 20px 8px; font-weight: 600; }
        .nav-item { padding: 10px 20px; display: flex; align-items: center; gap: 10px; color: var(--text-secondary); cursor: pointer; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: rgba(79,70,229,0.1); color: var(--primary-light); }
        .main { margin-left: 220px; flex: 1; padding: 24px 32px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .header h2 { font-size: 24px; font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); border-radius: 12px; padding: 16px; border: 1px solid var(--border); }
        .stat-card h3 { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 700; }
        .section-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); margin: 24px 0 16px; }
        .robots-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
        .robot-card { background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border); }
        .robot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .robot-info { display: flex; align-items: center; gap: 12px; }
        .robot-avatar { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: white; }
        .robot-name { font-size: 16px; font-weight: 600; }
        .robot-owner { font-size: 12px; color: var(--text-secondary); }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .status-badge.online { background: rgba(63,185,80,0.15); color: var(--success); }
        .status-badge.offline { background: rgba(110,118,129,0.15); color: var(--offline); }
        .robot-metrics { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 16px 0; }
        .metric { background: var(--bg-dark); border-radius: 8px; padding: 12px; }
        .metric-label { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; }
        .metric-value { font-size: 14px; font-weight: 600; }
        .progress-bar { height: 6px; background: var(--bg-dark); border-radius: 3px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-light)); }
        .tasks-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .task-column { background: var(--bg-card); border-radius: 12px; padding: 16px; border: 1px solid var(--border); }
        .task-column h4 { font-size: 14px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .task-column h4.todo { color: var(--text-secondary); }
        .task-column h4.running { color: var(--running); }
        .task-column h4.blocked { color: var(--warning); }
        .task-column h4.done { color: var(--success); }
        .task-card { background: var(--bg-dark); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .task-title { font-size: 14px; font-weight: 500; margin-bottom: 8px; }
        .task-meta { font-size: 12px; color: var(--text-secondary); display: flex; justify-content: space-between; }
        .collab-list { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
        .collab-item { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border); }
        .collab-item:last-child { border-bottom: none; }
        .collab-icon { width: 40px; height: 40px; background: rgba(79,70,229,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 16px; }
        .collab-info { flex: 1; }
        .collab-name { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
        .collab-task { font-size: 12px; color: var(--text-secondary); }
        .collab-participants { display: flex; gap: 8px; }
        .participant { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }
        .participant.robot { background: var(--primary); color: white; }
        .participant.human { background: var(--success); color: white; }
        .loading { padding: 40px; text-align: center; color: var(--text-secondary); }
        .spinner { width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .view-content { display: none; }
        .view-content.active { display: block; }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo"><div class="logo-icon">ğŸš€</div><h1>FleetHub</h1></div>
            <div class="nav-label">æ¦‚è§ˆ</div>
            <div class="nav-item active" onclick="switchView('dashboard')">ğŸ“Š Dashboard</div>
            <div class="nav-label">ç®¡ç†</div>
            <div class="nav-item" onclick="switchView('robots')">ğŸ¤– æœºå™¨äºº</div>
            <div class="nav-item" onclick="switchView('tasks')">ğŸ“‹ ä»»åŠ¡</div>
            <div class="nav-item" onclick="switchView('collab')">ğŸ’¬ åä½œ</div>
        </aside>
        <main class="main">
            <header class="header">
                <h2>Dashboard</h2>
                <button onclick="refreshAll()" style="padding:8px 16px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;">ğŸ”„ åˆ·æ–°</button>
            </header>
            <div class="stats-grid">
                <div class="stat-card"><h3>æ€»æœºå™¨äºº</h3><div class="stat-value" id="stat-total">-</div></div>
                <div class="stat-card"><h3>åœ¨çº¿</h3><div class="stat-value" id="stat-online" style="color:var(--success)">-</div></div>
                <div class="stat-card"><h3>ç¦»çº¿</h3><div class="stat-value" id="stat-offline" style="color:var(--offline)">-</div></div>
                <div class="stat-card"><h3>æ´»è·ƒä»»åŠ¡</h3><div class="stat-value" id="stat-tasks">-</div></div>
                <div class="stat-card"><h3>åä½œä¼šè¯</h3><div class="stat-value" id="stat-collab">-</div></div>
            </div>
            <div id="view-dashboard" class="view-content active">
                <div class="section-title">ğŸ¤– æœºå™¨äººçŠ¶æ€</div>
                <div class="robots-grid" id="robots-grid"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
                <div class="section-title">ğŸ’¬ æ´»è·ƒåä½œ</div>
                <div class="collab-list" id="collab-list"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
            </div>
            <div id="view-robots" class="view-content">
                <div class="robots-grid" id="robots-grid-full"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
            </div>
            <div id="view-tasks" class="view-content">
                <div class="tasks-board" id="tasks-board"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
            </div>
            <div id="view-collab" class="view-content">
                <div class="collab-list" id="collab-list-full"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></div>
            </div>
        </main>
    </div>
    <script>
        const DATA_URL = 'https://raw.githubusercontent.com/guyuan9300-max/fleethub/main/';
        async function loadJSON(file) { try { const res = await fetch(DATA_URL + file + '?t=' + Date.now()); if (res.ok) return await res.json(); } catch(e) { console.error(file, e); } return null; }
        async function refreshAll() {
            const [robots, tasks, collab] = await Promise.all([loadJSON('robots.json'), loadJSON('tasks.json'), loadJSON('collab.json')]);
            renderStats(robots, tasks, collab); renderRobots(robots); renderTasks(tasks); renderCollab(collab);
        }
        function renderStats(robots, tasks, collab) {
            const online = (robots||[]).filter(r => r.status === 'online').length;
            const offline = (robots||[]).filter(r => r.status === 'offline').length;
            const activeTasks = (tasks||[]).filter(t => t.status === 'RUNNING').length;
            document.getElementById('stat-total').textContent = (robots||[]).length || 0;
            document.getElementById('stat-online').textContent = online;
            document.getElementById('stat-offline').textContent = offline;
            document.getElementById('stat-tasks').textContent = activeTasks;
            document.getElementById('stat-collab').textContent = (collab||[]).length || 0;
        }
        function renderRobots(robots) {
            if (!robots || robots.length === 0) { const msg = '<div class="loading">æš‚æ— æœºå™¨äººæ•°æ®</div>'; document.getElementById('robots-grid').innerHTML = msg; document.getElementById('robots-grid-full').innerHTML = msg; return; }
            const colors = {'é¡¾æºæºçš„ MacBook Air': '#4F46E5', 'é»˜é»˜æœºå™¨äºº': '#10B981'};
            const html = robots.map(r => {
                const color = colors[r.name] || '#6E7681';
                return `<div class="robot-card"><div class="robot-header"><div class="robot-info"><div class="robot-avatar" style="background:${color}">${r.name[0]}</div><div><div class="robot-name">${r.name}</div><div class="robot-owner">${r.owner} Â· ${r.location}</div></div></div><span class="status-badge ${r.status}">${r.status === 'online' ? 'ğŸŸ¢ åœ¨çº¿' : 'ğŸ”´ ç¦»çº¿'}</span></div><div class="robot-metrics"><div class="metric"><div class="metric-label">CPU</div><div class="metric-value">${r.cpu}%</div></div><div class="metric"><div class="metric-label">å†…å­˜</div><div class="metric-value">${r.memory}%</div></div><div class="metric"><div class="metric-label">ç‰ˆæœ¬</div><div class="metric-value">${r.version}</div></div><div class="metric"><div class="metric-label">å¥åº·åº¦</div><div class="metric-value" style="color:${r.health_score > 70 ? 'var(--success)' : 'var(--warning)'}">${r.health_score || '-'}%</div></div></div><div class="metric"><div class="metric-label">å½“å‰ä»»åŠ¡</div><div class="metric-value" style="color:var(--primary-light)">${r.current_task || 'å¾…å‘½ä¸­'}</div></div><div class="progress-bar"><div class="progress-fill" style="width:${r.progress || 0}%"></div></div></div>`;
            }).join('');
            document.getElementById('robots-grid').innerHTML = html;
            document.getElementById('robots-grid-full').innerHTML = html;
        }
        function renderTasks(tasks) {
            if (!tasks || tasks.length === 0) { document.getElementById('tasks-board').innerHTML = '<div class="loading">æš‚æ— ä»»åŠ¡</div>'; return; }
            const cols = { TODO: [], RUNNING: [], BLOCKED: [], DONE: [] };
            tasks.forEach(t => { if (cols[t.status]) cols[t.status].push(t); });
            const html = Object.entries(cols).map(([status, list]) => `<div class="task-column"><h4 class="${status.toLowerCase()}">${status === 'TODO' ? 'ğŸ“ å¾…åŠ' : status === 'RUNNING' ? 'ğŸ”„ è¿›è¡Œä¸­' : status === 'BLOCKED' ? 'âš ï¸ é˜»å¡' : 'âœ… å®Œæˆ'} (${list.length})</h4>${list.map(t => `<div class="task-card"><div class="task-title">${t.title}</div><div class="task-meta"><span>ğŸ‘¤ ${t.current_owner_robot_id || 'æœªåˆ†é…'}</span><span>${t.progress}%</span></div></div>`).join('')}</div>`).join('');
            document.getElementById('tasks-board').innerHTML = html;
        }
        function renderCollab(collab) {
            if (!collab || collab.length === 0) { const msg = '<div class="loading">æš‚æ— åä½œ</div>'; document.getElementById('collab-list').innerHTML = msg; document.getElementById('collab-list-full').innerHTML = msg; return; }
            const html = collab.map(c => `<div class="collab-item"><div class="collab-icon">ğŸ’¬</div><div class="collab-info"><div class="collab-name">${c.chat_name || c.chat_id}</div><div class="collab-task">ğŸ“‹ ${c.task_id || 'æ— å…³è”ä»»åŠ¡'}</div></div><div class="collab-participants">${c.participants.map(p => `<div class="participant ${p.type}" title="${p.name}">${p.name[0]}</div>`).join('')}</div></div>`).join('');
            document.getElementById('collab-list').innerHTML = html;
            document.getElementById('collab-list-full').innerHTML = html;
        }
        function switchView(view) {
            document.querySelectorAll('.view-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + view).classList.add('active');
            event.target.classList.add('active');
        }
        refreshAll();
        setInterval(refreshAll, 30000);
    </script>
</body>
</html>
